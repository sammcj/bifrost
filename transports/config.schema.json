{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://www.getbifrost.ai/schema",
  "title": "Bifrost Configuration Schema",
  "description": "Schema for Bifrost HTTP transport configuration",
  "type": "object",
  "properties": {
    "encryption_key": {
      "type": "string",
      "description": "You can set the value as env.<ENV_VAR_NAME> to use an environment variable. We also read encryption key from BIFROST_ENCRYPTION_KEY environment variable. Note: once set, the encryption key cannot be changed unless you clean up the database. Accepts any string; a secure 32-byte AES-256 key will be derived using Argon2id KDF. If not provided, data will be saved in plain text. Recommended: use a passphrase of at least 16 bytes for better security"
    },
    "client": {
      "type": "object",
      "description": "Client configuration settings",
      "properties": {
        "drop_excess_requests": {
          "type": "boolean",
          "description": "Whether to drop excess requests when pool is full"
        },
        "initial_pool_size": {
          "type": "integer",
          "minimum": 1,
          "description": "Initial size of the connection pool",
          "default": 300
        },
        "prometheus_labels": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Labels to use for Prometheus metrics"
        },
        "allowed_origins": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string",
                "const": "*"
              },
              {
                "type": "string",
                "format": "uri"
              }
            ]
          },
          "description": "CORS allowed origins (supports \"*\" or URI strings)"
        },
        "enable_logging": {
          "type": "boolean",
          "description": "Enable request/response logging"
        },
        "disable_content_logging": {
          "type": "boolean",
          "description": "Disable logging of sensitive content (inputs, outputs, embeddings, etc.)"
        },
        "disable_db_pings_in_health": {
          "type": "boolean",
          "description": "Disable DB pings in health check",
          "default": false
        },
        "log_retention_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of days to retain logs",
          "default": 365
        },
        "enable_governance": {
          "type": "boolean",
          "description": "Enable governance features"
        },
        "enforce_governance_header": {
          "type": "boolean",
          "description": "Enforce governance header. This will require every incoming request to include x-bf-vk header."
        },
        "allow_direct_keys": {
          "type": "boolean",
          "description": "Allow provider keys"
        },
        "max_request_body_size_mb": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum request body size in MB"
        },
        "enable_litellm_fallbacks": {
          "type": "boolean",
          "description": "Enable litellm-specific fallbacks for text completion for Groq"
        },
        "header_filter_config": {
          "type": "object",
          "description": "Global header filtering configuration for x-bf-eh-* headers forwarded to LLM providers",
          "properties": {
            "allowlist": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "If non-empty, only these headers (from x-bf-eh-* prefix) are allowed to be forwarded"
            },
            "denylist": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Headers to always block from being forwarded"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "framework": {
      "type": "object",
      "properties": {
        "pricing": {
          "$ref": "#/$defs/pricing_config"
        }
      },
      "additionalProperties": false
    },
    "providers": {
      "type": "object",
      "description": "AI provider configurations",
      "properties": {
        "openai": {
          "$ref": "#/$defs/provider"
        },
        "anthropic": {
          "$ref": "#/$defs/provider"
        },
        "bedrock": {
          "$ref": "#/$defs/provider_with_bedrock_config"
        },
        "cohere": {
          "$ref": "#/$defs/provider"
        },
        "azure": {
          "$ref": "#/$defs/provider_with_azure_config"
        },
        "vertex": {
          "$ref": "#/$defs/provider_with_vertex_config"
        },
        "mistral": {
          "$ref": "#/$defs/provider"
        },
        "ollama": {
          "$ref": "#/$defs/provider"
        },
        "groq": {
          "$ref": "#/$defs/provider"
        },
        "gemini": {
          "$ref": "#/$defs/provider"
        },
        "openrouter": {
          "$ref": "#/$defs/provider"
        },
        "sgl": {
          "$ref": "#/$defs/provider"
        },
        "parasail": {
          "$ref": "#/$defs/provider"
        },
        "perplexity": {
          "$ref": "#/$defs/provider"
        },
        "elevenlabs": {
          "$ref": "#/$defs/provider"
        },
        "cerebras": {
          "$ref": "#/$defs/provider"
        },
        "huggingface": {
          "$ref": "#/$defs/provider"
        }
      },
      "additionalProperties": true
    },
    "governance": {
      "type": "object",
      "description": "Governance configuration for budgets, rate limits, customers, teams, and virtual keys",
      "properties": {
        "budgets": {
          "type": "array",
          "description": "Budget configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Budget ID"
              },
              "max_limit": {
                "type": "number",
                "description": "Maximum budget limit in dollars"
              },
              "reset_duration": {
                "type": "string",
                "description": "Budget reset duration (e.g., '30s', '5m', '1h', '1d', '1w', '1M', '1Y')"
              },
              "current_usage": {
                "type": "number",
                "description": "Current usage in dollars",
                "default": 0
              },
              "last_reset": {
                "type": "string",
                "format": "date-time",
                "description": "Last time budget was reset"
              }
            },
            "required": [
              "id",
              "max_limit",
              "reset_duration"
            ],
            "additionalProperties": false
          }
        },
        "rate_limits": {
          "type": "array",
          "description": "Rate limit configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Rate limit ID"
              },
              "token_max_limit": {
                "type": "integer",
                "description": "Maximum tokens allowed"
              },
              "token_reset_duration": {
                "type": "string",
                "description": "Token reset duration (e.g., '30s', '5m', '1h', '1d', '1w', '1M', '1Y')"
              },
              "token_current_usage": {
                "type": "integer",
                "description": "Current token usage",
                "default": 0
              },
              "token_last_reset": {
                "type": "string",
                "format": "date-time",
                "description": "Last time token counter was reset"
              },
              "request_max_limit": {
                "type": "integer",
                "description": "Maximum requests allowed"
              },
              "request_reset_duration": {
                "type": "string",
                "description": "Request reset duration (e.g., '30s', '5m', '1h', '1d', '1w', '1M', '1Y')"
              },
              "request_current_usage": {
                "type": "integer",
                "description": "Current request usage",
                "default": 0
              },
              "request_last_reset": {
                "type": "string",
                "format": "date-time",
                "description": "Last time request counter was reset"
              }
            },
            "required": [
              "id"
            ],
            "additionalProperties": false
          }
        },
        "customers": {
          "type": "array",
          "description": "Customer configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Customer ID"
              },
              "name": {
                "type": "string",
                "description": "Customer name"
              },
              "budget_id": {
                "type": "string",
                "description": "Associated budget ID"
              }
            },
            "required": [
              "id",
              "name"
            ],
            "additionalProperties": false
          }
        },
        "teams": {
          "type": "array",
          "description": "Team configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Team ID"
              },
              "name": {
                "type": "string",
                "description": "Team name"
              },
              "customer_id": {
                "type": "string",
                "description": "Associated customer ID"
              },
              "budget_id": {
                "type": "string",
                "description": "Associated budget ID"
              },
              "profile": {
                "type": "object",
                "description": "Team profile data"
              },
              "config": {
                "type": "object",
                "description": "Team configuration data"
              },
              "claims": {
                "type": "object",
                "description": "Team claims data"
              }
            },
            "required": [
              "id",
              "name"
            ],
            "additionalProperties": false
          }
        },
        "virtual_keys": {
          "type": "array",
          "description": "Virtual key configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Virtual key ID"
              },
              "name": {
                "type": "string",
                "description": "Virtual key name"
              },
              "description": {
                "type": "string",
                "description": "Virtual key description"
              },
              "value": {
                "type": "string",
                "description": "The virtual key value"
              },
              "is_active": {
                "type": "boolean",
                "description": "Whether the virtual key is active",
                "default": true
              },
              "team_id": {
                "type": "string",
                "description": "Associated team ID (mutually exclusive with customer_id)"
              },
              "customer_id": {
                "type": "string",
                "description": "Associated customer ID (mutually exclusive with team_id)"
              },
              "budget_id": {
                "type": "string",
                "description": "Associated budget ID"
              },
              "rate_limit_id": {
                "type": "string",
                "description": "Associated rate limit ID"
              },
              "provider_configs": {
                "type": "array",
                "description": "Provider configurations for this virtual key (empty means all providers allowed)",
                "items": {
                  "$ref": "#/$defs/virtual_key_provider_config"
                }
              },
              "mcp_configs": {
                "type": "array",
                "description": "MCP configurations for this virtual key",
                "items": {
                  "$ref": "#/$defs/virtual_key_mcp_config"
                }
              }
            },
            "required": [
              "id",
              "name",
              "value"
            ],
            "additionalProperties": false
          }
        },
        "auth_config": {
          "$ref": "#/$defs/auth_config"
        }
      },
      "additionalProperties": false
    },
    "mcp": {
      "type": "object",
      "description": "Model Context Protocol configuration",
      "properties": {
        "client_configs": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/mcp_client_config"
          },
          "description": "MCP client configurations"
        },
        "tool_manager_config": {
          "$ref": "#/$defs/mcp_tool_manager_config"
        }
      },
      "additionalProperties": false
    },
    "vector_store": {
      "type": "object",
      "description": "Vector store configuration for caching",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable vector store"
        },
        "type": {
          "type": "string",
          "enum": [
            "weaviate",
            "redis",
            "qdrant",
            "pinecone"
          ],
          "description": "Vector store type"
        },
        "config": {
          "anyOf": [
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "weaviate"
                  }
                }
              },
              "then": {
                "$ref": "#/$defs/weaviate_config"
              }
            },
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "redis"
                  }
                }
              },
              "then": {
                "$ref": "#/$defs/redis_config"
              }
            },
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "qdrant"
                  }
                }
              },
              "then": {
                "$ref": "#/$defs/qdrant_config"
              }
            },
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "pinecone"
                  }
                }
              },
              "then": {
                "$ref": "#/$defs/pinecone_config"
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "config_store": {
      "type": "object",
      "description": "Configuration store settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable configuration store"
        },
        "type": {
          "type": "string",
          "enum": [
            "sqlite",
            "postgres"
          ],
          "description": "Configuration store type"
        },
        "config": {
          "anyOf": [
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "sqlite"
                  }
                }
              },
              "then": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Database file path"
                  }
                },
                "required": [
                  "path"
                ],
                "additionalProperties": false
              }
            },
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "postgres"
                  }
                }
              },
              "then": {
                "type": "object",
                "properties": {
                  "host": {
                    "type": "string",
                    "description": "Database host"
                  },
                  "port": {
                    "type": "string",
                    "description": "Database port"
                  },
                  "user": {
                    "type": "string",
                    "description": "Database user"
                  },
                  "password": {
                    "type": "string",
                    "description": "Database password. Leave empty if you want to use IAM role authentication."
                  },
                  "db_name": {
                    "type": "string",
                    "description": "Database name"
                  },
                  "ssl_mode": {
                    "type": "string",
                    "description": "Database SSL mode"
                  },
                  "max_idle_conns": {
                    "type": "integer",
                    "description": "Maximum number of idle connections in the pool (default: 5)",
                    "minimum": 0,
                    "default": 5
                  },
                  "max_open_conns": {
                    "type": "integer",
                    "description": "Maximum number of open connections to the database (default: 50)",
                    "minimum": 2,
                    "default": 50
                  }
                },
                "required": [
                  "host",
                  "port",
                  "user",
                  "password",
                  "db_name",
                  "ssl_mode"
                ],
                "additionalProperties": false
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "logs_store": {
      "type": "object",
      "description": "Logs store settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable logs store"
        },
        "type": {
          "type": "string",
          "enum": [
            "sqlite",
            "postgres"
          ],
          "description": "Logs store type"
        },
        "config": {
          "type": "object",
          "oneOf": [
            {
              "if": {
                "properties": {
                  "../type": {
                    "const": "sqlite"
                  }
                }
              },
              "then": {
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Database file path"
                  }
                },
                "required": [
                  "path"
                ],
                "additionalProperties": false
              }
            },
            {
              "if": {
                "properties": {
                  "../type": {
                    "const": "postgres"
                  }
                }
              },
              "then": {
                "properties": {
                  "host": {
                    "type": "string",
                    "description": "Database host"
                  },
                  "port": {
                    "type": "integer",
                    "description": "Database port"
                  },
                  "user": {
                    "type": "string",
                    "description": "Database user"
                  },
                  "password": {
                    "type": "string",
                    "description": "Database password. Leave empty if you want to use IAM role authentication."
                  },
                  "db_name": {
                    "type": "string",
                    "description": "Database name"
                  },
                  "ssl_mode": {
                    "type": "string",
                    "description": "Database SSL mode"
                  },
                  "max_idle_conns": {
                    "type": "integer",
                    "description": "Maximum number of idle connections in the pool (default: 5)",
                    "minimum": 0,
                    "default": 5
                  },
                  "max_open_conns": {
                    "type": "integer",
                    "description": "Maximum number of open connections to the database (default: 50)",
                    "minimum": 2,
                    "default": 50
                  }
                },
                "required": [
                  "host",
                  "port",
                  "user",
                  "password",
                  "db_name",
                  "ssl_mode"
                ],
                "additionalProperties": false
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "cluster_config": {
      "$ref": "#/$defs/cluster_config"
    },
    "saml_config": {
      "$ref": "#/$defs/saml_config"
    },
    "load_balancer_config": {
      "$ref": "#/$defs/load_balancer_config"
    },
    "guardrails_config": {
      "$ref": "#/$defs/guardrails_config"
    },
    "plugins": {
      "type": "array",
      "description": "Plugins configuration",
      "items": {
        "type": "object",
        "required": [
          "enabled",
          "name"
        ],
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Enable plugins"
          },
          "name": {
            "type": "string",
            "description": "Name of the plugin (built-in: telemetry, logging, governance, maxim, semanticcache, otel, or custom plugin name)"
          },
          "config": {
            "type": "object",
            "description": "Configuration for the plugin"
          },
          "path": {
            "type": "string",
            "description": "Path to the plugin (optional, required for dynamic plugins)",
            "optional": true
          },
          "version": {
            "type": "integer",
            "minimum": 1,
            "description": "Version of the plugin (default: 1). Increment in this number will force a reload of the plugin and DB update.",
            "optional": true,
            "default": 1
          }
        },
        "allOf": [
          {
            "if": {
              "properties": {
                "name": {
                  "const": "telemetry"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the telemetry plugin (Prometheus metrics)",
                  "properties": {},
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "logging"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the logging plugin",
                  "properties": {},
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "governance"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the governance plugin",
                  "properties": {
                    "is_vk_mandatory": {
                      "type": "boolean",
                      "description": "Whether virtual key (x-bf-vk header) is mandatory for all requests"
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "maxim"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the Maxim SDK integration plugin",
                  "properties": {
                    "api_key": {
                      "type": "string",
                      "description": "API key for Maxim SDK authentication"
                    },
                    "log_repo_id": {
                      "type": "string",
                      "description": "Optional default ID for the Maxim logger instance"
                    }
                  },
                  "required": [
                    "api_key"
                  ],
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "semanticcache"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the semantic cache plugin",
                  "properties": {
                    "provider": {
                      "type": "string",
                      "description": "Provider to use for generating embeddings",
                      "enum": [
                        "openai",
                        "anthropic",
                        "gemini",
                        "bedrock",
                        "azure",
                        "cohere",
                        "mistral",
                        "groq",
                        "ollama",
                        "openrouter",
                        "vertex",
                        "cerebras",
                        "parasail",
                        "perplexity",
                        "sgl",
                        "huggingface"
                      ]
                    },
                    "keys": {
                      "type": "array",
                      "description": "API keys for the embedding provider",
                      "items": {
                        "type": "string"
                      },
                      "minItems": 1
                    },
                    "embedding_model": {
                      "type": "string",
                      "description": "Model to use for generating embeddings (optional)"
                    },
                    "cleanup_on_shutdown": {
                      "type": "boolean",
                      "description": "Clean up cache on shutdown (default: false)"
                    },
                    "ttl": {
                      "description": "Time-to-live for cached responses (supports duration strings like '5m', '1h' or seconds as number, default: 5min)",
                      "oneOf": [
                        {
                          "type": "string",
                          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$"
                        },
                        {
                          "type": "integer",
                          "minimum": 0
                        }
                      ]
                    },
                    "threshold": {
                      "type": "number",
                      "description": "Cosine similarity threshold for semantic matching (default: 0.8)",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "vector_store_namespace": {
                      "type": "string",
                      "description": "Namespace for vector store (optional)"
                    },
                    "dimension": {
                      "type": "integer",
                      "description": "Dimension for vector store embeddings",
                      "minimum": 1
                    },
                    "conversation_history_threshold": {
                      "type": "integer",
                      "description": "Skip caching for requests with more than this number of messages in conversation history (default: 3)",
                      "minimum": 0
                    },
                    "cache_by_model": {
                      "type": "boolean",
                      "description": "Include model in cache key (default: true)"
                    },
                    "cache_by_provider": {
                      "type": "boolean",
                      "description": "Include provider in cache key (default: true)"
                    },
                    "exclude_system_prompt": {
                      "type": "boolean",
                      "description": "Exclude system prompt in cache key (default: false)"
                    }
                  },
                  "required": [
                    "provider",
                    "keys",
                    "dimension"
                  ],
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "otel"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the OpenTelemetry plugin",
                  "properties": {
                    "service_name": {
                      "type": "string",
                      "description": "Service name to be used for tracing",
                      "default": "bifrost"
                    },
                    "collector_url": {
                      "type": "string",
                      "description": "URL of the OpenTelemetry collector",
                      "oneOf": [
                        {
                          "format": "uri"
                        },
                        {
                          "pattern": "^[^:\\s]+:\\d+$"
                        }
                      ]
                    },
                    "trace_type": {
                      "type": "string",
                      "description": "Type of trace to use for the OTEL collector",
                      "enum": [
                        "otel"
                      ]
                    },
                    "protocol": {
                      "type": "string",
                      "description": "Protocol to use for the OTEL collector",
                      "enum": [
                        "http",
                        "grpc"
                      ]
                    }
                  },
                  "required": [
                    "collector_url",
                    "trace_type",
                    "protocol"
                  ],
                  "additionalProperties": false
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "datadog"
                }
              }
            },
            "then": {
              "required": [
                "config"
              ],
              "properties": {
                "config": {
                  "type": "object",
                  "description": "Configuration for the Datadog APM and metrics plugin",
                  "properties": {
                    "service_name": {
                      "type": "string",
                      "description": "Name of the service to report to Datadog",
                      "default": "bifrost"
                    },
                    "agent_addr": {
                      "type": "string",
                      "description": "Address of the Datadog Agent for APM traces",
                      "default": "localhost:8126"
                    },
                    "env": {
                      "type": "string",
                      "description": "Environment tag (e.g., production, staging)"
                    },
                    "version": {
                      "type": "string",
                      "description": "Service version tag"
                    },
                    "custom_tags": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Additional tags to add to all traces and metrics"
                    },
                    "enable_traces": {
                      "type": "boolean",
                      "description": "Enable APM traces (default: true)",
                      "default": true
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          }
        ],
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "virtual_key_provider_config": {
      "type": "object",
      "description": "Provider configuration for a virtual key",
      "properties": {
        "id": {
          "type": "integer",
          "description": "Provider config ID"
        },
        "virtual_key_id": {
          "type": "string",
          "description": "Associated virtual key ID"
        },
        "provider": {
          "type": "string",
          "description": "Provider name"
        },
        "weight": {
          "type": "number",
          "description": "Weight for load balancing",
          "default": 1.0
        },
        "allowed_models": {
          "type": "array",
          "description": "Allowed models for this provider config (empty means all models allowed)",
          "items": {
            "type": "string"
          }
        },
        "budget_id": {
          "type": "string",
          "description": "Associated budget ID"
        },
        "rate_limit_id": {
          "type": "string",
          "description": "Associated rate limit ID"
        },
        "keys": {
          "type": "array",
          "description": "Provider keys for this config (empty means all keys allowed for this provider)",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "description": "Key database ID (auto-generated)"
              },
              "key_id": {
                "type": "string",
                "description": "Key UUID identifier"
              },
              "name": {
                "type": "string",
                "description": "Key name (must be unique)"
              },
              "value": {
                "type": "string",
                "description": "API key value (can use env. prefix)"
              },
              "models": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Supported models for this key"
              },
              "weight": {
                "type": "number",
                "minimum": 0,
                "default": 1.0,
                "description": "Weight for load balancing"
              },
              "azure_key_config": {
                "type": "object",
                "properties": {
                  "endpoint": {
                    "type": "string",
                    "description": "Azure endpoint (can use env. prefix)"
                  },
                  "deployments": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Model to deployment mappings"
                  },
                  "api_version": {
                    "type": "string",
                    "description": "Azure API version"
                  }
                },
                "required": [
                  "endpoint"
                ],
                "additionalProperties": false
              },
              "vertex_key_config": {
                "type": "object",
                "properties": {
                  "project_id": {
                    "type": "string",
                    "description": "Google Cloud project ID (can use env. prefix)"
                  },
                  "project_number": {
                    "type": "string",
                    "description": "Google Cloud project number"
                  },
                  "region": {
                    "type": "string",
                    "description": "Google Cloud region"
                  },
                  "auth_credentials": {
                    "type": "string",
                    "description": "Authentication credentials (can use env. prefix)"
                  },
                  "deployments": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Model to deployment mappings"
                  }
                },
                "required": [
                  "project_id",
                  "region"
                ],
                "additionalProperties": false
              },
              "bedrock_key_config": {
                "type": "object",
                "properties": {
                  "access_key": {
                    "type": "string",
                    "description": "AWS access key (can use env. prefix)"
                  },
                  "secret_key": {
                    "type": "string",
                    "description": "AWS secret key (can use env. prefix)"
                  },
                  "session_token": {
                    "type": "string",
                    "description": "AWS session token (can use env. prefix)"
                  },
                  "region": {
                    "type": "string",
                    "description": "AWS region"
                  },
                  "arn": {
                    "type": "string",
                    "description": "AWS ARN"
                  },
                  "deployments": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Model to deployment mappings"
                  }
                },
                "additionalProperties": false
              }
            },
            "oneOf": [
              {
                "not": {
                  "anyOf": [
                    {
                      "required": [
                        "azure_key_config"
                      ]
                    },
                    {
                      "required": [
                        "vertex_key_config"
                      ]
                    },
                    {
                      "required": [
                        "bedrock_key_config"
                      ]
                    }
                  ]
                }
              },
              {
                "required": [
                  "azure_key_config"
                ],
                "not": {
                  "anyOf": [
                    {
                      "required": [
                        "vertex_key_config"
                      ]
                    },
                    {
                      "required": [
                        "bedrock_key_config"
                      ]
                    }
                  ]
                }
              },
              {
                "required": [
                  "vertex_key_config"
                ],
                "not": {
                  "anyOf": [
                    {
                      "required": [
                        "azure_key_config"
                      ]
                    },
                    {
                      "required": [
                        "bedrock_key_config"
                      ]
                    }
                  ]
                }
              },
              {
                "required": [
                  "bedrock_key_config"
                ],
                "not": {
                  "anyOf": [
                    {
                      "required": [
                        "azure_key_config"
                      ]
                    },
                    {
                      "required": [
                        "vertex_key_config"
                      ]
                    }
                  ]
                }
              }
            ],
            "required": [
              "key_id",
              "name",
              "value"
            ]
          }
        }
      },
      "required": [
        "provider"
      ],
      "additionalProperties": false
    },
    "virtual_key_mcp_config": {
      "type": "object",
      "description": "MCP configuration for a virtual key",
      "properties": {
        "id": {
          "type": "integer",
          "description": "MCP config ID"
        },
        "virtual_key_id": {
          "type": "string",
          "description": "Associated virtual key ID"
        },
        "mcp_client_id": {
          "type": "integer",
          "description": "Associated MCP client ID"
        },
        "tools_to_execute": {
          "type": "array",
          "description": "Tools to execute for this MCP config",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "mcp_client_id"
      ],
      "additionalProperties": false
    },
    "auth_config": {
      "type": "object",
      "properties": {
        "admin_username": {
          "type": "string",
          "description": "Admin username"
        },
        "admin_password": {
          "type": "string",
          "description": "Admin password"
        },
        "is_enabled": {
          "type": "boolean",
          "description": "Whether authentication is enabled"
        },
        "disable_auth_on_inference": {
          "type": "boolean",
          "description": "Whether authentication is disabled on inference"
        }
      },
      "additionalProperties": false
    },
    "pricing_config": {
      "type": "object",
      "properties": {
        "pricing_url": {
          "type": "string",
          "description": "Pricing URL",
          "optional": true,
          "format": "uri"
        },
        "pricing_sync_interval": {
          "type": "integer",
          "description": "Pricing sync interval in seconds. Default is 24 hours. Minimum is 3600 seconds (1 hour).",
          "default": 86400,
          "optional": true,
          "minimum": 3600
        }
      },
      "additionalProperties": false
    },
    "network_config": {
      "type": "object",
      "properties": {
        "base_url": {
          "type": "string",
          "format": "uri",
          "description": "Base URL for the provider (optional, required for Ollama)"
        },
        "extra_headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Additional headers to send with requests"
        },
        "default_request_timeout_in_seconds": {
          "type": "integer",
          "minimum": 1,
          "description": "Default request timeout in seconds"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum number of retries"
        },
        "retry_backoff_initial_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Initial retry backoff in milliseconds"
        },
        "retry_backoff_max_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum retry backoff in milliseconds"
        }
      },
      "additionalProperties": false
    },
    "concurrency_config": {
      "type": "object",
      "properties": {
        "concurrency": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of concurrent requests"
        },
        "buffer_size": {
          "type": "integer",
          "minimum": 1,
          "description": "Buffer size for requests"
        }
      },
      "required": [
        "concurrency",
        "buffer_size"
      ],
      "additionalProperties": false
    },
    "base_key": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the key"
        },
        "value": {
          "type": "string",
          "description": "API key value (can use env. prefix)"
        },
        "models": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "Supported models for this key"
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "description": "Weight for load balancing"
        },
        "use_for_batch_api": {
          "type": "boolean",
          "description": "Whether this key can be used for batch API operations (default: false)",
          "default": false
        }
      },
      "required": [
        "name",
        "value",
        "weight"
      ],
      "additionalProperties": false
    },
    "bedrock_key": {
      "allOf": [
        {
          "$ref": "#/$defs/base_key"
        },
        {
          "type": "object",
          "properties": {
            "bedrock_key_config": {
              "type": "object",
              "properties": {
                "access_key": {
                  "type": "string",
                  "description": "AWS access key (can use env. prefix)"
                },
                "secret_key": {
                  "type": "string",
                  "description": "AWS secret key (can use env. prefix)"
                },
                "session_token": {
                  "type": "string",
                  "description": "AWS session token (can use env. prefix)"
                },
                "deployments": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  },
                  "description": "Model to deployment mappings"
                },
                "arn": {
                  "type": "string",
                  "description": "AWS ARN"
                },
                "region": {
                  "type": "string",
                  "description": "AWS region"
                }
              },
              "required": [
                "region"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "bedrock_key_config"
          ]
        }
      ]
    },
    "azure_key": {
      "allOf": [
        {
          "$ref": "#/$defs/base_key"
        },
        {
          "type": "object",
          "properties": {
            "azure_key_config": {
              "type": "object",
              "properties": {
                "endpoint": {
                  "type": "string",
                  "description": "Azure endpoint (can use env. prefix)"
                },
                "deployments": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  },
                  "description": "Model to deployment mappings"
                },
                "api_version": {
                  "type": "string",
                  "description": "Azure API version"
                }
              },
              "required": [
                "endpoint",
                "api_version"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "azure_key_config"
          ]
        }
      ]
    },
    "vertex_key": {
      "allOf": [
        {
          "$ref": "#/$defs/base_key"
        },
        {
          "type": "object",
          "properties": {
            "vertex_key_config": {
              "type": "object",
              "properties": {
                "project_id": {
                  "type": "string",
                  "description": "Google Cloud project ID (can use env. prefix)"
                },
                "region": {
                  "type": "string",
                  "description": "Google Cloud region"
                },
                "auth_credentials": {
                  "type": "string",
                  "description": "Authentication credentials (can use env. prefix)"
                }
              },
              "required": [
                "project_id",
                "region"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "vertex_key_config"
          ]
        }
      ]
    },
    "provider": {
      "type": "object",
      "properties": {
        "keys": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/base_key"
          },
          "minItems": 1,
          "description": "API keys for this provider"
        },
        "network_config": {
          "$ref": "#/$defs/network_config"
        },
        "concurrency_and_buffer_size": {
          "$ref": "#/$defs/concurrency_config"
        },
        "proxy_config": {
          "$ref": "#/$defs/proxy_config"
        },
        "send_back_raw_response": {
          "type": "boolean",
          "description": "Include raw response in BifrostResponse (default: false)"
        }
      },
      "required": [
        "keys"
      ],
      "additionalProperties": false
    },
    "provider_with_bedrock_config": {
      "type": "object",
      "properties": {
        "keys": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/bedrock_key"
          },
          "minItems": 1,
          "description": "API keys for this provider"
        },
        "network_config": {
          "$ref": "#/$defs/network_config"
        },
        "concurrency_and_buffer_size": {
          "$ref": "#/$defs/concurrency_config"
        },
        "proxy_config": {
          "$ref": "#/$defs/proxy_config"
        },
        "send_back_raw_response": {
          "type": "boolean",
          "description": "Include raw response in BifrostResponse (default: false)"
        }
      },
      "required": [
        "keys"
      ],
      "additionalProperties": false
    },
    "provider_with_azure_config": {
      "type": "object",
      "properties": {
        "keys": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/azure_key"
          },
          "minItems": 1,
          "description": "API keys for this provider"
        },
        "network_config": {
          "$ref": "#/$defs/network_config"
        },
        "concurrency_and_buffer_size": {
          "$ref": "#/$defs/concurrency_config"
        },
        "proxy_config": {
          "$ref": "#/$defs/proxy_config"
        },
        "send_back_raw_response": {
          "type": "boolean",
          "description": "Include raw response in BifrostResponse (default: false)"
        }
      },
      "required": [
        "keys"
      ],
      "additionalProperties": false
    },
    "provider_with_vertex_config": {
      "type": "object",
      "properties": {
        "keys": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/vertex_key"
          },
          "minItems": 1,
          "description": "API keys for this provider"
        },
        "network_config": {
          "$ref": "#/$defs/network_config"
        },
        "concurrency_and_buffer_size": {
          "$ref": "#/$defs/concurrency_config"
        },
        "proxy_config": {
          "$ref": "#/$defs/proxy_config"
        },
        "send_back_raw_response": {
          "type": "boolean",
          "description": "Include raw response in BifrostResponse (default: false)"
        }
      },
      "required": [
        "keys"
      ],
      "additionalProperties": false
    },
    "mcp_client_config": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the MCP client"
        },
        "connection_type": {
          "type": "string",
          "enum": [
            "stdio",
            "websocket",
            "http"
          ],
          "description": "Connection type for MCP client"
        },
        "stdio_config": {
          "type": "object",
          "properties": {
            "command": {
              "type": "string",
              "description": "Command to execute"
            },
            "args": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Command arguments"
            },
            "envs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Environment variables"
            }
          },
          "required": [
            "command"
          ],
          "additionalProperties": false
        },
        "websocket_config": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "format": "uri",
              "description": "WebSocket URL"
            }
          },
          "required": [
            "url"
          ],
          "additionalProperties": false
        },
        "http_config": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "format": "uri",
              "description": "HTTP URL"
            }
          },
          "required": [
            "url"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "name",
        "connection_type"
      ],
      "additionalProperties": false,
      "oneOf": [
        {
          "properties": {
            "connection_type": {
              "const": "stdio"
            }
          },
          "required": [
            "stdio_config"
          ]
        },
        {
          "properties": {
            "connection_type": {
              "const": "websocket"
            }
          },
          "required": [
            "websocket_config"
          ]
        },
        {
          "properties": {
            "connection_type": {
              "const": "http"
            }
          },
          "required": [
            "http_config"
          ]
        }
      ]
    },
    "mcp_tool_manager_config": {
      "type": "object",
      "properties": {
        "tool_execution_timeout": {
          "type": "integer",
          "description": "Tool execution timeout in seconds",
          "minimum": 1,
          "default": 30
        },
        "max_agent_depth": {
          "type": "integer",
          "description": "Max agent depth",
          "minimum": 1,
          "default": 10
        }
      }
    },
    "weaviate_config": {
      "type": "object",
      "description": "Weaviate configuration for vector store",
      "properties": {
        "scheme": {
          "type": "string",
          "description": "Weaviate server scheme (http or https) - REQUIRED"
        },
        "host": {
          "type": "string",
          "description": "Weaviate server host (host:port) - REQUIRED"
        },
        "api_key": {
          "type": "string",
          "description": "API key for Weaviate authentication (optional)"
        },
        "grpc_config": {
          "type": "object",
          "properties": {
            "host": {
              "type": "string",
              "description": "Weaviate server host (host:port). If host is without a port number then the 80 port for insecured and 443 port for secured connections will be used."
            },
            "secured": {
              "type": "boolean",
              "description": "Secured set it to true if it's a secured connection"
            }
          }
        },
        "headers": {
          "type": "object",
          "description": "Additional headers to send with requests"
        },
        "timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Timeout for Weaviate operations (e.g., '5s')"
        },
        "class_name": {
          "type": "string",
          "description": "Class name for Weaviate vector store"
        },
        "properties": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Properties for Weaviate vector store"
        }
      },
      "required": [
        "scheme",
        "host"
      ],
      "additionalProperties": false
    },
    "redis_config": {
      "type": "object",
      "description": "Redis configuration for vector store",
      "properties": {
        "addr": {
          "type": "string",
          "description": "Redis server address (host:port) - REQUIRED (can use env. prefix)"
        },
        "username": {
          "type": "string",
          "description": "Username for Redis AUTH (optional, can use env. prefix)"
        },
        "password": {
          "type": "string",
          "description": "Password for Redis AUTH (optional, can use env. prefix)"
        },
        "db": {
          "type": "integer",
          "description": "Redis database number (default: 0)",
          "default": 0
        },
        "pool_size": {
          "type": "integer",
          "description": "Maximum number of socket connections (optional)"
        },
        "max_active_conns": {
          "type": "integer",
          "description": "Maximum number of active connections (optional)"
        },
        "min_idle_conns": {
          "type": "integer",
          "description": "Minimum number of idle connections (optional)"
        },
        "max_idle_conns": {
          "type": "integer",
          "description": "Maximum number of idle connections (optional)"
        },
        "conn_max_lifetime": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Connection maximum lifetime (e.g., '30m')"
        },
        "conn_max_idle_time": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Connection maximum idle time (e.g., '5m')"
        },
        "dial_timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Timeout for socket connection (e.g., '5s')"
        },
        "read_timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Timeout for socket reads (e.g., '3s')"
        },
        "write_timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Timeout for socket writes (e.g., '3s')"
        },
        "context_timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|Âµs|ms|s|m|h)$",
          "description": "Timeout for Redis operations (e.g., '10s')"
        }
      },
      "required": [
        "addr"
      ],
      "additionalProperties": false
    },
    "qdrant_config": {
      "type": "object",
      "description": "Qdrant configuration for vector store",
      "properties": {
        "host": {
          "type": "string",
          "description": "Qdrant server host - REQUIRED (can use env. prefix)"
        },
        "port": {
          "type": "integer",
          "description": "Qdrant server port (default: 6334 for gRPC)",
          "default": 6334
        },
        "api_key": {
          "type": "string",
          "description": "API key for authentication (optional, can use env. prefix)"
        },
        "use_tls": {
          "type": "boolean",
          "description": "Use TLS for connection (optional)",
          "default": false
        }
      },
      "required": [
        "host"
      ],
      "additionalProperties": false
    },
    "pinecone_config": {
      "type": "object",
      "description": "Pinecone configuration for vector store",
      "properties": {
        "api_key": {
          "type": "string",
          "description": "Pinecone API key - REQUIRED (can use env. prefix)"
        },
        "index_host": {
          "type": "string",
          "description": "Index host URL from Pinecone console - REQUIRED (e.g., your-index.svc.environment.pinecone.io)"
        }
      },
      "required": [
        "api_key",
        "index_host"
      ],
      "additionalProperties": false
    },
    "proxy_config": {
      "type": "object",
      "description": "Proxy configuration for provider connections",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "none",
            "http",
            "socks5",
            "environment"
          ],
          "description": "Type of proxy to use"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL of the proxy server"
        },
        "username": {
          "type": "string",
          "description": "Username for proxy authentication"
        },
        "password": {
          "type": "string",
          "description": "Password for proxy authentication"
        },
        "ca_cert_pem": {
          "type": "string",
          "description": "PEM-encoded CA certificate to trust for TLS connections through the proxy (for SSL-intercepting proxies)"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "cluster_config": {
      "type": "object",
      "description": "Cluster mode configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether cluster mode is enabled"
        },
        "peers": {
          "type": "array",
          "description": "List of peer addresses",
          "items": {
            "type": "string",
            "description": "Peer address in host:port format"
          }
        },
        "gossip": {
          "type": "object",
          "description": "Gossip protocol configuration",
          "properties": {
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535,
              "description": "Port for gossip communication"
            },
            "config": {
              "type": "object",
              "description": "Gossip protocol settings",
              "properties": {
                "timeout_seconds": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Timeout for operations in seconds"
                },
                "success_threshold": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Number of successful probes required"
                },
                "failure_threshold": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Number of failed probes before marking as failed"
                }
              },
              "required": [
                "timeout_seconds",
                "success_threshold",
                "failure_threshold"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "port",
            "config"
          ],
          "additionalProperties": false
        },
        "discovery": {
          "type": "object",
          "description": "Auto-discovery configuration for cluster nodes",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether auto-discovery is enabled"
            },
            "type": {
              "type": "string",
              "enum": [
                "kubernetes",
                "dns",
                "udp",
                "consul",
                "etcd",
                "mdns"
              ],
              "description": "Discovery mechanism type"
            },
            "allowed_address_space": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "CIDR notation for allowed address spaces (e.g., ['10.0.0.0/8', '192.168.0.0/16'])"
            },
            "k8s_namespace": {
              "type": "string",
              "description": "Kubernetes namespace for service discovery"
            },
            "k8s_label_selector": {
              "type": "string",
              "description": "Kubernetes label selector for filtering pods"
            },
            "dns_names": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "DNS names to resolve for node discovery"
            },
            "udp_broadcast_port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535,
              "description": "Port for UDP broadcast discovery"
            },
            "consul_address": {
              "type": "string",
              "description": "Consul server address for service discovery"
            },
            "etcd_endpoints": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Etcd endpoints for service discovery"
            },
            "mdns_service": {
              "type": "string",
              "description": "mDNS service name for local network discovery"
            }
          },
          "required": [
            "type"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "enabled"
      ],
      "additionalProperties": false
    },
    "saml_config": {
      "type": "object",
      "description": "SAML/SCIM (System for Cross-domain Identity Management) configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether SAML/SCIM authentication is enabled"
        },
        "provider": {
          "type": "string",
          "enum": [
            "okta",
            "entra"
          ],
          "description": "SCIM provider type"
        },
        "config": {
          "type": "object",
          "description": "Provider-specific configuration"
        }
      },
      "required": [
        "enabled"
      ],
      "additionalProperties": false,
      "allOf": [
        {
          "if": {
            "properties": {
              "provider": {
                "const": "okta"
              }
            }
          },
          "then": {
            "properties": {
              "config": {
                "$ref": "#/$defs/okta_config"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "provider": {
                "const": "entra"
              }
            }
          },
          "then": {
            "properties": {
              "config": {
                "$ref": "#/$defs/entra_config"
              }
            }
          }
        }
      ]
    },
    "okta_config": {
      "type": "object",
      "description": "Okta JWT authentication configuration",
      "properties": {
        "issuerUrl": {
          "type": "string",
          "format": "uri",
          "description": "Okta issuer URL (e.g., https://your-domain.okta.com/oauth2/default)"
        },
        "clientId": {
          "type": "string",
          "description": "Okta application client ID"
        },
        "clientSecret": {
          "type": "string",
          "description": "Okta client secret (optional, required for token revocation)"
        },
        "audience": {
          "type": "string",
          "description": "JWT audience for validation (optional)"
        },
        "userIdField": {
          "type": "string",
          "description": "JWT claim field for user ID (default: 'sub')",
          "default": "sub"
        },
        "teamIdsField": {
          "type": "string",
          "description": "JWT claim field for team IDs (default: 'groups')",
          "default": "groups"
        },
        "rolesField": {
          "type": "string",
          "description": "JWT claim field for roles (default: 'roles')",
          "default": "roles"
        }
      },
      "required": [
        "issuerUrl",
        "clientId"
      ],
      "additionalProperties": false
    },
    "entra_config": {
      "type": "object",
      "description": "Microsoft Entra ID (formerly Azure AD) JWT authentication configuration",
      "properties": {
        "tenantId": {
          "type": "string",
          "description": "Azure tenant ID or 'common' for multi-tenant applications"
        },
        "clientId": {
          "type": "string",
          "description": "Application (client) ID from Azure portal"
        },
        "clientSecret": {
          "type": "string",
          "description": "Client secret (optional, required for token revocation)"
        },
        "audience": {
          "type": "string",
          "description": "JWT audience for validation (default: clientId)"
        },
        "appIdUri": {
          "type": "string",
          "format": "uri",
          "description": "App ID URI for v1.0 tokens (e.g., api://{clientId})"
        },
        "userIdField": {
          "type": "string",
          "description": "JWT claim field for user ID (default: 'oid')",
          "default": "oid"
        },
        "teamIdsField": {
          "type": "string",
          "description": "JWT claim field for team IDs (default: 'groups')",
          "default": "groups"
        },
        "rolesField": {
          "type": "string",
          "description": "JWT claim field for roles (default: 'roles')",
          "default": "roles"
        }
      },
      "required": [
        "tenantId",
        "clientId"
      ],
      "additionalProperties": false
    },
    "load_balancer_config": {
      "type": "object",
      "description": "Load balancer configuration for intelligent request routing",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether load balancing is enabled"
        },
        "tracker_config": {
          "type": "object",
          "description": "Configuration for tracking route metrics and performance"
        },
        "bootstrap": {
          "type": "object",
          "description": "Bootstrap data for initializing load balancer with historical metrics",
          "properties": {
            "route_metrics": {
              "type": "object",
              "description": "Historical metrics per route"
            },
            "direction_metrics": {
              "type": "object",
              "description": "Historical metrics per direction"
            },
            "routes": {
              "type": "object",
              "description": "Known routes"
            }
          }
        }
      },
      "required": [
        "enabled"
      ],
      "additionalProperties": false
    },
    "guardrails_config": {
      "type": "object",
      "description": "Guardrails configuration for content moderation and policy enforcement",
      "properties": {
        "guardrail_rules": {
          "type": "array",
          "description": "List of guardrail rules",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "description": "Unique identifier for the rule"
              },
              "name": {
                "type": "string",
                "description": "Name of the guardrail rule"
              },
              "description": {
                "type": "string",
                "description": "Description of what the rule does"
              },
              "enabled": {
                "type": "boolean",
                "description": "Whether this rule is enabled"
              },
              "cel_expression": {
                "type": "string",
                "description": "CEL (Common Expression Language) expression for rule evaluation"
              },
              "apply_to": {
                "type": "string",
                "enum": [
                  "input",
                  "output",
                  "both"
                ],
                "description": "When to apply the guardrail (input, output, or both)"
              },
              "sampling_rate": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100,
                "description": "Percentage of requests to apply this rule to (0-100)"
              },
              "timeout": {
                "type": "integer",
                "minimum": 0,
                "description": "Timeout in milliseconds for rule execution"
              },
              "provider_config_ids": {
                "type": "array",
                "items": {
                  "type": "integer"
                },
                "description": "IDs of provider configurations to use with this rule"
              }
            },
            "required": [
              "id",
              "name",
              "enabled",
              "cel_expression",
              "apply_to"
            ],
            "additionalProperties": false
          }
        },
        "guardrail_providers": {
          "type": "array",
          "description": "List of guardrail provider configurations",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "description": "Unique identifier for the provider config"
              },
              "provider_name": {
                "type": "string",
                "description": "Name of the guardrail provider (e.g., 'bedrock', 'azure')"
              },
              "policy_name": {
                "type": "string",
                "description": "Name of the specific policy to use"
              },
              "enabled": {
                "type": "boolean",
                "description": "Whether this provider config is enabled"
              },
              "config": {
                "type": "object",
                "description": "Provider-specific configuration"
              }
            },
            "required": [
              "id",
              "provider_name",
              "policy_name",
              "enabled"
            ],
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    }
  }
}